#!<%= @shell %>

<%- @_env_vars.sort.each do |key,val| -%>
export <%= key -%>='<%= val %>'
<%- end -%>

<%- @pre_commands.each do |cmd| -%>
<%= cmd %>
<%- end -%>

duplicity \
  <%- @_flags.each do |flag| -%>
  <%= flag -%> \
  <%- end -%>
  <%- @_options.sort.each do |key,val| -%>
  <%= key -%> <%= val -%> \
  <%- end -%>
  <%- @directories.each do |dir| -%>
  --include "<%= dir -%>" \
  <%- end -%>
  --exclude '**' \
  / \
  <%= @target_url %>

<%- if @remove_older_than != false -%>
duplicity remove-older-than <%= @remove_older_than -%> --no-print-statistics --verbosity error <%= @target_url %>
<%- end -%>

<%- @post_commands.each do |cmd| -%>
<%= cmd %>
<%- end -%>
